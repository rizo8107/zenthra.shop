services:
  frontend:
    build:
      context: ./Frontend
      dockerfile: Dockerfile
      args:
        VITE_POCKETBASE_URL: ${VITE_POCKETBASE_URL}
        VITE_RAZORPAY_KEY_ID: ${VITE_RAZORPAY_KEY_ID}
        VITE_EVOLUTION_API_KEY: ${VITE_EVOLUTION_API_KEY}
        VITE_EVOLUTION_API_URL: ${VITE_EVOLUTION_API_URL}
        VITE_EVOLUTION_INSTANCE_NAME: ${VITE_EVOLUTION_INSTANCE_NAME}
        VITE_CRM_ORDER_ENDPOINT: ${VITE_CRM_ORDER_ENDPOINT}
        VITE_SITE_TITLE: ${VITE_SITE_TITLE}
        VITE_SITE_LOGO: ${VITE_SITE_LOGO}
        VITE_GOOGLE_MAPS_API_KEY: ${VITE_GOOGLE_MAPS_API_KEY}
        VITE_ZENTHRA_FRONTEND_URL: ${VITE_ZENTHRA_FRONTEND_URL}
        VITE_ZENTHRA_AUTH_PATH: ${VITE_ZENTHRA_AUTH_PATH}
    expose:
      - "80"
    restart: unless-stopped

  cms:
    build:
      context: ./Backend
      dockerfile: Dockerfile
      args:
        VITE_POCKETBASE_URL: ${VITE_POCKETBASE_URL}
        VITE_RAZORPAY_KEY_ID: ${VITE_RAZORPAY_KEY_ID}
        VITE_CMS_BASE: "/"  # ensure backend builds for root when running on its own port
        VITE_VAPID_PUBLIC_KEY: ${VITE_VAPID_PUBLIC_KEY}
        VITE_EVOLUTION_API_KEY: ${VITE_EVOLUTION_API_KEY}
        VITE_EVOLUTION_API_URL: ${VITE_EVOLUTION_API_URL}
        VITE_EVOLUTION_INSTANCE_NAME: ${VITE_EVOLUTION_INSTANCE_NAME}
    expose:
      - "8080"
    restart: unless-stopped

# Usage:
# 1) Ensure .env at repo root contains all variables referenced above.
# 2) docker compose up --build -d
#    Frontend: http://localhost:8080
#    CMS:      http://localhost:4000
